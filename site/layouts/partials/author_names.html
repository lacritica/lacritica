{{ with .Params.author }}
  {{/* Collect rendered author HTML (linked or not) into a slice */}}
  {{- $authors := slice -}}

  {{ range . }}
    {{ $raw := . }}
    {{ $authorClean := replaceRE "[\\[\\]]" "" $raw }}

    {{/* -- normalization block unchanged -- */}}
    {{ $norm := $authorClean | lower }}
    {{ $norm = replaceRE "[áàâäãåā]" "a" $norm }}
    {{ $norm = replaceRE "[éèêëē]" "e" $norm }}
    {{ $norm = replaceRE "[íìîïī]" "i" $norm }}
    {{ $norm = replaceRE "[óòôöõō]" "o" $norm }}
    {{ $norm = replaceRE "[úùûüū]" "u" $norm }}
    {{ $norm = replaceRE "[ñ]" "n" $norm }}
    {{ $norm = replaceRE "[ç]" "c" $norm }}
    {{ $norm = replaceRE "[^a-z0-9\\s-]" "" $norm }}
    {{ $authorSlug := urlize $norm }}

    {{/* -- page-finding block unchanged -- */}}
    {{ $authorPage := site.GetPage (printf "/autores/%s" $authorSlug) }}
    {{ if not $authorPage }}
      {{ $authorPage = where site.RegularPages "Params.slug" $authorSlug | first 1 }}
    {{ end }}
    {{ if not $authorPage }}
      {{ $authorPage = where site.RegularPages "RelPermalink" (print "/autores/" $authorSlug "/") | first 1 }}
    {{ end }}
    {{ if not $authorPage }}
      {{ $cand := where site.RegularPages "Section" "autores" }}
      {{ range $cand }}
        {{ $candidateName := .Params.name | default .Title | lower }}
        {{ $candidateName = replaceRE "[áàâäãåā]" "a" $candidateName }}
        {{ $candidateName = replaceRE "[éèêëē]" "e" $candidateName }}
        {{ $candidateName = replaceRE "[íìîïī]" "i" $candidateName }}
        {{ $candidateName = replaceRE "[óòôöõō]" "o" $candidateName }}
        {{ $candidateName = replaceRE "[úùûüū]" "u" $candidateName }}
        {{ $candidateName = replaceRE "[ñ]" "n" $candidateName }}
        {{ $candidateName = replaceRE "[ç]" "c" $candidateName }}
        {{ $candidateName = replaceRE "[^a-z0-9\\s-]" "" $candidateName }}
        {{ if eq (urlize $candidateName) $authorSlug }}
          {{ $authorPage = . }}
          {{ break }}
        {{ end }}
      {{ end }}
    {{ end }}

    {{/* Build the HTML for this author */}}
    {{ if $authorPage }}
      {{ $authors = $authors | append (printf "<a class=\"author-link\" href=\"%s\">%s</a>" $authorPage.RelPermalink $authorClean) }}
    {{ else }}
      {{ $authors = $authors | append $authorClean }}
    {{ end }}

  {{ end }}

  {{/* --- Spanish formatting logic --- */}}
  <div class="post-author">
    <div class="author-block">
      <h3 class="author-name">

{{ $n := len $authors }}

{{ if eq $n 1 }}
  {{ index $authors 0 | safeHTML }}

{{ else if eq $n 2 }}
  {{ printf "%s y %s" (index $authors 0) (index $authors 1) | safeHTML }}

{{ else if eq $n 3 }}
  {{ printf "%s, %s y %s" (index $authors 0) (index $authors 1) (index $authors 2) | safeHTML }}

{{ else if gt $n 3 }}
  {{ printf "%s, %s, …, %s" (index $authors 0) (index $authors 1) (index $authors (sub $n 1)) | safeHTML }}

{{ end }}


      </h3>
    </div>
  </div>

{{ end }}
